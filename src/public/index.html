<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Document</title>
      
      <script src="./lib/socket.io.min.js"></script>
      <link rel="stylesheet" href="style.css">
     
      
</head>
<body>
      
         <div id="inputs">
            <h1>Simple Chat</h1><br>
            <div id="chatBox">
                  <div id="ctext">
                       <ul id="dataB" style="list-style-type: none;">
                        <p style="text-align: center;">now you are talking with random people from internet <br>have fun :)</p>
                             <li>Lorem ipo 12 consectetur !</li><br>
                             <li>Lorem ipsum dolor sit amet consectetur !</li><br>
                             <li>Lorem ipo sit amet consectetur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Lorem ipsum dolor sit amet consectetur !</li><br>
                             <li>Loumlor sit consectetur !</li><br>
                             <li>Lorem ipo sit amet consectetur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Lorem ipsum dolor sit amet consectetur !</li><br>
                             <li>Lorem ipsum dolor sit amet consectetur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Lorem ipo sit amet consectetur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Loumlor sit consectetur !</li><br>
                             <li>Lorem ipo sit amet consectetur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Loumlor sit consectetur !</li><br>
                             <li>Lorem ipo sit amet consectetur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Lorem ipsum doloramet cur !</li><br>
                             <li>Loumlor sit consectetur !</li><br>
                             <li>Lorem ipsum 343 cur !</li><br>
                             
                       </ul> 
                  </div>
                  
                       <div style="margin:unset;">
                             
                             <input id="msg" placeholder="Say something" type="text"> 
                             <!--
                                   <button id="submit" onclick="send()">send</button>   
                             -->
                       </div>
                  <br>
                  <br>
            </div>
            <br>
            
      </div>   
      
      
      
      <script>
            checkCookie()
            //Using Socket.io
            const url = window.location.href
            const socket = io(url)
            const sub = document.querySelector('#submit')
            const  cUserName = "user_name"
            
            

            

            function requestName(){
                let userName = prompt("Enter your name!!")

                  if(userName=="" || userName == null){
                        userName = "stranger"
                        alert(`Now your name is "${userName}"`)
                        document.querySelector('#msg').placeholder = `type as ${userName}`
                        return userName


                  }else{
                       // alert(`Now your name is "${userName}"`)
                        document.querySelector('#msg').placeholder = `type as ${userName}`
                        return userName
                  } 
            }
            
            
            
            
            //EVENTS
            
            // WebSokeckt events
            socket.on("new_client", data =>{
                  alert(`a new stranger is among us !!`)
            })
            
            socket.on('hey', data => addMsg(data))

            
            document.addEventListener('keydown', event =>{
                  if(event.key=="Enter"){
                        send()
                  }
            })
            
                  
                  
            
            
            // METHODS>>>>>>
            function setCookie(name){
                  console.log("seting cookies")
                  document.cookie = `user_name=${name}`
            }

            function getCookie(cname) {
                  let name = cname + "=";
                  let decodedCookie = decodeURIComponent(document.cookie);
                  let ca = decodedCookie.split(';');

                  for(let i = 0; i <ca.length; i++) {
                        let c = ca[i];
                        while (c.charAt(0) == ' ') {
                              c = c.substring(1);
                        }

                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                  }
                  return "";
            }

            function checkCookie() {
                  console.log("checking cookies")
                  let username = getCookie("user_name");
                  if (username != "") {
                        alert("Welcome again " + username);
                        document.querySelector('#msg').placeholder = `type as ${username}`
                  } else{
                        username = requestName()
                        setCookie(username);
                        
                  }
            }

            function addMsg(data){
                  let ele = document.createElement('li')
                  let br = document.createElement('br')
                  ele.textContent= `From ${data.author}: ${data.message}`
                  document.querySelector("#dataB").appendChild(ele)
                  document.querySelector("#dataB").appendChild(br)
            }

            function send(){
                  let message = document.querySelector('#msg')
                  
                  if(message){ 
                        const data = {
                              message :message.value,
                              author :getCookie("user_name") 
                        }
                        socket.emit("msg", data)
                        message.value = ""
                        console.log(data);
                        return
                  }else{
                        alert("type something!!!")
                        return
                  }    
                  
            }


            //Methods

           

      //"https://cdn.socket.io/3.1.3/socket.io.min.js"
      </script>
</body>
</html>